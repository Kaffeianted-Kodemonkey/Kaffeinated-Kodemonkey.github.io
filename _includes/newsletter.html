<form id="newsletter-form" class="mt-5">
  <div class="row mb-3">
    <label for="cname" class="col-sm-2 col-form-label"><span class="text-danger">* </span>Company Name:</label>
    <div class="col-sm-6">
      <input type="text" class="form-control" id="cname" name="cname" required>
    </div>
  </div>
  <div class="row mb-3">
    <label for="fname" class="col-sm-2 col-form-label"><span class="text-danger">* </span>First Name:</label>
    <div class="col-sm-6">
      <input type="text" class="form-control" id="fname" name="fname" required>
    </div>
  </div>
  <div class="row mb-3">
    <label for="lname" class="col-sm-2 col-form-label"><span class="text-danger">* </span>Last Name:</label>
    <div class="col-sm-6">
      <input type="text" class="form-control" id="lname" name="lname" required>
    </div>
  </div>
  <div class="row mb-3">
    <label for="inputEmail3" class="col-sm-2 col-form-label"><span class="text-danger">* </span>Email</label>
    <div class="col-sm-6">
      <input type="email" class="form-control" id="inputEmail3" name="email" required>
    </div>
  </div>
  <input type="hidden" id="subject" value="Newsletter Signup Request">
  <input type="hidden" id="message" value="New signup from website.">

  <button type="submit" class="btn btn-primary">Join Newsletter</button>
  <div class="alert alert-success d-none mt-3" id="success-message" role="alert"></div>
  <div class="alert alert-danger d-none mt-3" id="error-message" role="alert"></div>
</form>

<script>
document.getElementById('newsletter-form').addEventListener('submit', async function(e) {
  e.preventDefault();

  const successMsg = document.getElementById('success-message');
  const errorMsg = document.getElementById('error-message');
  successMsg.classList.add('d-none');
  errorMsg.classList.add('d-none');

  const fname = document.getElementById('fname').value.trim();
  const lname = document.getElementById('lname').value.trim();
  const email = document.getElementById('inputEmail3').value.trim();
  const cname = document.getElementById('cname').value.trim();
  const subject = document.getElementById('subject').value;
  let message = document.getElementById('message').value;
  message += `\n\nCompany: ${cname}\nFull Name: ${fname} ${lname}\nEmail: ${email}`;

  if (!fname || !lname || !email || !cname) {
    errorMsg.textContent = 'Please fill in all required fields.';
    errorMsg.classList.remove('d-none');
    return;
  }

  const payload = {
    name: `${fname} ${lname}`,
    email: email,
    subject: subject,
    message: message
    // Add custom field if needed: c: { '1': cname } (replace '1' with field ID)
  };

  try {
    const response = await fetch('https://caffeinatedcodemonkey.com/client-tracking/api/tickets.json', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-API-Key': '16168D2EBFF8DF1D2A504D1C148A0B35' // Replace with valid key
      },
      body: JSON.stringify(payload)
    });

    const data = await response.json();
    if (response.ok && data.id) {
      successMsg.textContent = `Success! Ticket ID: ${data.id}. Check your email.`;
      successMsg.classList.remove('d-none');
      this.reset();
    } else {
      throw new Error(data.error || `HTTP ${response.status}: ${response.statusText}`);
    }
  } catch (error) {
    console.error('Fetch Error:', error);
    errorMsg.textContent = `Failed to submit ticket: ${error.message}. Try again or contact support.`;
    errorMsg.classList.remove('d-none');
  }
});
</script>
